# FHEPropRate - 全同态加密房地产评分 dApp 需求文档

## 项目概述

**项目名称**：FHEPropRate (FHE Property Rating)  
**项目类型**：基于 FHEVM 的全同态加密房地产评分去中心化应用  
**核心价值**：保护用户隐私的同时实现透明的房地产评分系统  

## 项目背景

在传统房地产评分系统中，用户的评分数据往往面临隐私泄露风险。FHEPropRate 利用全同态加密技术，让用户可以在不暴露个人评分数据的情况下，参与房地产项目的评分，同时保证评分结果的透明性和可验证性。

## 核心功能模块

### 1. 创建评分项目 (Create Rating Project)
- **功能描述**：房地产开发商或项目方可以创建新的评分项目
- **输入数据**：
  - 项目名称 (明文)
  - 项目描述 (明文)
  - 项目地址 (明文)
  - 评分维度配置 (明文)
  - 评分有效期 (明文)
- **加密数据**：
  - 项目创建者身份验证 (加密)
  - 项目唯一标识符 (加密)

### 2. 参与评分 (Participate in Rating)
- **功能描述**：用户对房地产项目进行多维度评分
- **评分维度**：
  - 位置便利性 (1-10分)
  - 建筑质量 (1-10分)
  - 周边配套 (1-10分)
  - 交通便利性 (1-10分)
  - 性价比 (1-10分)
  - 投资潜力 (1-10分)
- **加密处理**：所有评分数据使用 FHEVM 加密存储
- **防重复**：每个地址对同一项目只能评分一次

### 3. 我的创建 (My Creations)
- **功能描述**：项目创建者查看自己创建的所有评分项目
- **显示内容**：
  - 项目列表
  - 参与评分人数 (加密统计)
  - 平均评分 (加密计算)
  - 项目状态 (进行中/已结束)

### 4. 我的评分 (My Ratings)
- **功能描述**：用户查看自己参与过的所有评分
- **显示内容**：
  - 已评分项目列表
  - 我的评分详情 (解密后显示)
  - 评分时间
  - 项目状态

### 5. 解密评分统计图表 (Decrypted Rating Analytics)
- **功能描述**：提供可视化的评分统计分析
- **图表类型**：
  - 各维度平均分雷达图
  - 评分分布直方图
  - 时间趋势图
  - 对比分析图
- **权限控制**：只有项目创建者可以查看详细统计

## 技术架构

### 智能合约层
- **主合约**：PropertyRatingContract.sol
- **加密类型**：使用 `euint32` 存储评分数据
- **FHE 运算**：使用 `FHE.add`, `FHE.div` 等计算平均分
- **访问控制**：使用 `FHE.allow` 和 `FHE.allowThis` 管理权限

### 前端应用层
- **框架**：Next.js 14 + TypeScript
- **状态管理**：React Hooks + Context
- **UI 组件**：自定义组件库 + Tailwind CSS
- **图表库**：Chart.js 或 Recharts

### 加密交互层
- **本地开发**：使用 `@fhevm/mock-utils`
- **测试网/主网**：使用 `@zama-fhe/relayer-sdk`
- **动态切换**：根据 chainId 自动选择

## 页面结构

### 1. 欢迎页 (Welcome Page)
- 项目介绍和核心价值
- 快速开始指南
- 钱包连接入口

### 2. 导航栏 (Navigation)
- 项目 Logo 和名称
- 主要功能入口
- 钱包连接状态
- 用户菜单

### 3. 钱包连接 (Wallet Connection)
- 支持 MetaMask 等主流钱包
- 网络切换提示
- 连接状态持久化

### 4. 评分功能主体 (Main Rating Interface)
- 项目列表展示
- 评分表单
- 实时统计预览
- 操作反馈

## 数据流程

### 创建评分项目流程
1. 用户填写项目信息
2. 合约验证创建者身份
3. 生成项目唯一标识
4. 存储项目元数据
5. 返回项目 ID

### 参与评分流程
1. 用户选择评分项目
2. 填写各维度评分
3. 前端加密评分数据
4. 提交到智能合约
5. 更新项目统计信息
6. 返回交易哈希

### 解密统计流程
1. 项目创建者请求统计
2. 合约返回加密统计数据
3. 前端解密数据
4. 生成可视化图表
5. 展示分析结果

## 安全考虑

### 隐私保护
- 所有评分数据全程加密
- 用户身份与评分数据分离
- 支持评分数据匿名化

### 防作弊机制
- 每个地址只能评分一次
- 评分范围验证 (1-10分)
- 时间窗口限制

### 访问控制
- 基于角色的权限管理
- 加密数据访问授权
- 操作审计日志

## 部署配置

### 网络支持
- **本地开发**：Hardhat 本地网络 (chainId: 31337)
- **测试网**：Sepolia 测试网 (chainId: 11155111)
- **主网**：以太坊主网 (chainId: 1)

### 环境变量
```bash
# 合约部署
SEPOLIA_PRIVATE_KEY=0x...
INFURA_API_KEY=...

# 前端配置
NEXT_PUBLIC_NETWORK=sepolia
NEXT_PUBLIC_CHAIN_ID=11155111
```

## 开发里程碑

### Phase 1: 核心合约开发
- [ ] PropertyRatingContract.sol 合约编写
- [ ] 基础评分功能实现
- [ ] 访问控制机制
- [ ] 单元测试编写

### Phase 2: 前端基础功能
- [ ] Next.js 项目搭建
- [ ] 钱包连接集成
- [ ] FHEVM 集成
- [ ] 基础 UI 组件

### Phase 3: 核心功能实现
- [ ] 创建评分项目功能
- [ ] 参与评分功能
- [ ] 我的创建/评分页面
- [ ] 数据加密/解密流程

### Phase 4: 统计图表功能
- [ ] 数据解密和统计
- [ ] 图表组件开发
- [ ] 可视化展示
- [ ] 权限控制

### Phase 5: 测试和优化
- [ ] 端到端测试
- [ ] 性能优化
- [ ] 安全审计
- [ ] 部署和文档

## 验收标准

### 功能验收
- [ ] 用户可以创建评分项目
- [ ] 用户可以参与评分 (防重复)
- [ ] 评分数据全程加密存储
- [ ] 可以解密并展示统计图表
- [ ] 钱包连接和网络切换正常

### 技术验收
- [ ] 合约编译和测试通过
- [ ] 前端构建成功
- [ ] 本地和测试网部署成功
- [ ] 加密→解密闭环完整
- [ ] 响应式设计适配

### 安全验收
- [ ] 评分数据隐私保护
- [ ] 访问控制正确实现
- [ ] 防作弊机制有效
- [ ] 无安全漏洞

## 项目特色

1. **隐私优先**：利用全同态加密技术保护用户评分隐私
2. **透明可信**：区块链技术确保评分过程透明可验证
3. **用户友好**：简洁直观的界面设计
4. **数据洞察**：丰富的统计分析和可视化
5. **去中心化**：无需中心化服务器，降低信任成本

---

**文档版本**：v1.0  
**创建日期**：2025-01-20  
**最后更新**：2025-01-20
